<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Colosseum: Auditing Collusion in Cooperative Multi‑Agent Systems</title>
  <meta name="description" content="Project page for the paper: Colosseum: Auditing Collusion in Cooperative Multi‑Agent Systems." />
  <style>
    :root{
      --bg:#0b1020;
      --panel:#0f1731;
      --panel2:#0c1329;
      --text:#eaf0ff;
      --muted:#b9c3e6;
      --muted2:#93a1d6;
      --line:rgba(255,255,255,.12);
      --shadow: 0 14px 50px rgba(0,0,0,.35);
      --radius:18px;
      --radius2:24px;
      --max:1100px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{
      margin:0;
      font-family: var(--sans);
      color:var(--text);
      /* Simplified background to avoid banding/gradient artifacts */
      background:
        radial-gradient(900px 520px at 20% -10%, rgba(118,174,255,.14), transparent 60%),
        radial-gradient(900px 520px at 90% 0%, rgba(182,132,255,.12), transparent 58%),
        linear-gradient(180deg, #050813, var(--bg));
      line-height:1.55;
      overflow-x:hidden;
    }

    a{color:inherit; text-decoration:none}
    a:hover{text-decoration:underline}

    .wrap{max-width:var(--max); margin:0 auto; padding:28px 18px 80px}

    /* Top nav */
    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(7,10,20,.92);
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{max-width:var(--max); margin:0 auto; padding:12px 18px; display:flex; gap:14px; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:10px; align-items:center}
    .logo{
      width:34px; height:34px; border-radius:12px;
      background: linear-gradient(135deg, rgba(118,174,255,1), rgba(182,132,255,1) 55%, rgba(88,255,208,1));
      box-shadow: 0 10px 30px rgba(118,174,255,.25);
    }
    .brand b{letter-spacing:.2px}

    .nav{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .nav a{font-size:13px; color:var(--muted); padding:7px 10px; border-radius:999px; border:1px solid transparent}
    .nav a:hover{border-color:var(--line); background:rgba(255,255,255,.03); text-decoration:none}

    /* Hero */
    .hero{padding:34px 0 20px}
    .kicker{
      display:inline-flex; gap:10px; align-items:center;
      padding:8px 12px; border-radius:999px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:13px;
    }
    .kicker .dot{width:8px; height:8px; border-radius:99px; background:rgba(88,255,208,1)}
    h1{margin:14px 0 14px; font-size:46px; line-height:1.12; letter-spacing:-1px; padding-bottom:4px;
      background:linear-gradient(135deg, rgba(234,240,255,1), rgba(118,174,255,.95) 35%, rgba(182,132,255,.95) 70%, rgba(88,255,208,.9));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .subtitle{font-size:18px; color:var(--muted); max-width:70ch}

    .heroGrid{display:grid; grid-template-columns: 1fr; gap:18px; margin-top:22px}
    @media (max-width: 900px){
      .heroGrid{grid-template-columns:1fr}
      h1{font-size:36px}
    }

    .card{
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(118,174,255,.10), transparent 55%),
        radial-gradient(900px 420px at 90% 0%, rgba(182,132,255,.10), transparent 55%),
        rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.14);
      border-radius:var(--radius2);
      box-shadow:var(--shadow);
    }
    .card .pad{padding:18px}

    .btnRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      font-weight:600; font-size:14px;
      text-decoration:none;
    }
    .btn:hover{background:rgba(255,255,255,.06); text-decoration:none}
    .btn.primary{
      border-color:rgba(118,174,255,.35);
      background:linear-gradient(135deg, rgba(118,174,255,.20), rgba(182,132,255,.12));
    }
    .btn.btnWhite{
      background:rgba(255,255,255,.92);
      color:#0b1020;
      border-color:rgba(255,255,255,.65);
    }
    .btn.btnWhite:hover{background:rgba(255,255,255,1);}
    .btn svg{opacity:.9}

    .meta{display:grid; grid-template-columns:1fr; gap:10px}
    .metaLine{display:flex; gap:8px; flex-wrap:wrap; align-items:baseline}
    .metaLine span{color:var(--muted2)}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--line); background:rgba(0,0,0,.18); font-size:12px; color:var(--muted)}

    /* Sections */
    section{padding:28px 0}
    .sectionTitle{font-size:22px; margin:0 0 10px; letter-spacing:-.2px}
    .lead{color:var(--muted); max-width:85ch}

    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:14px}
    .grid2 > *{min-width:0;} /* allow children to shrink inside grid */
    @media (max-width: 900px){.grid2{grid-template-columns:1fr}}

    .box{border-radius:var(--radius); border:1px solid var(--line); background:rgba(255,255,255,.03); min-width:0;}
    .box .pad{padding:16px}

    ul.clean{margin:10px 0 0; padding-left:18px; color:var(--muted)}
    ul.clean li{margin:8px 0}

    /* Figure */
    .figure{
      position:relative; overflow:hidden;
      border-radius:var(--radius2);
      border:1px solid var(--line);
      background: radial-gradient(800px 400px at 20% 10%, rgba(118,174,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 90% 20%, rgba(182,132,255,.18), transparent 58%),
                  radial-gradient(700px 500px at 50% 110%, rgba(88,255,208,.12), transparent 60%),
                  rgba(255,255,255,.02);
    }
    .figure .pad{padding:18px}
    .figure h3{margin:0 0 10px; font-size:16px; color:var(--muted)}
    .figure p{margin:0; color:var(--muted); font-size:13px}
    .svgWrap{margin-top:14px; border-radius:16px; background:rgba(0,0,0,.18); border:1px solid var(--line); overflow:hidden}

    /* Make tall figures look good without stretching the whole page */
    .figureMedia{max-height:380px; overflow:hidden;}
    .figureMedia img{width:100%; height:auto; display:block; object-fit:contain; cursor:zoom-in;}
    .figureActions{margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;}

    /* Lightbox */
    .lightbox{position:fixed; inset:0; display:none; align-items:center; justify-content:center; padding:24px; background:rgba(0,0,0,.72); z-index:1000;}
    .lightbox[aria-hidden="false"]{display:flex;}
    .lightboxInner{max-width:min(1100px, 96vw); max-height:92vh;}
    .lightboxInner img{width:100%; height:auto; max-height:92vh; border-radius:18px; border:1px solid var(--line); background:rgba(0,0,0,.25); cursor:zoom-out;}
    .lightboxClose{position:absolute; top:14px; right:14px; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,.05); color:var(--text); font-weight:700;}
    .lightboxClose:hover{background:rgba(255,255,255,.08);}

    /* Interactive demo */
    .demoTop{display:flex; align-items:flex-start; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{
      cursor:pointer;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:700;
      font-size:13px;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    .tab:hover{transform: translateY(-1px); background:rgba(255,255,255,.06);}
    .tab[aria-selected="true"]{
      color:var(--text);
      border-color:rgba(88,255,208,.35);
      background:rgba(88,255,208,.08);
    }

    .chat{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 900px){.chat{grid-template-columns:1fr}}

    .lane{border:1px solid rgba(255,255,255,.14); border-radius:var(--radius2); background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.14)); min-width:0;}
    .laneHeader{padding:12px 14px; border-bottom:1px solid var(--line); display:flex; align-items:center; justify-content:space-between}
    .laneHeader b{font-size:13px}
    .laneHeader span{font-size:12px; color:var(--muted2)}
    .msgs{padding:12px 14px; display:flex; flex-direction:column; gap:10px; max-height:320px; overflow:auto}

    .msg{padding:10px 11px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.03)}
    .msg .who{display:flex; justify-content:space-between; gap:10px; font-size:12px; color:var(--muted2); margin-bottom:6px}
    .msg .text{color:var(--text); font-size:13px; white-space:pre-wrap}
    .msg.good{border-color:rgba(118,174,255,.25); background:rgba(118,174,255,.06)}
    .msg.bad{border-color:rgba(255,120,120,.25); background:rgba(255,120,120,.06)}
    .msg.secret{border-color:rgba(182,132,255,.28); background:rgba(182,132,255,.06)}

    /* BibTeX */
    pre{
      margin:0;
      padding:16px;
      border-radius:var(--radius2);
      border:1px solid var(--line);
      background:rgba(0,0,0,.28);
      color:#d7e2ff;
      max-width:100%;
      overflow:auto;
      white-space:pre; /* keep BibTeX formatting */
      font-family:var(--mono);
      font-size:12.5px;
      line-height:1.55;
    }
    /* Prevent pre blocks from causing horizontal page overflow */
    pre code{white-space:pre;}

    .footer{padding-top:34px; border-top:1px solid var(--line); margin-top:30px; color:var(--muted); font-size:13px}
    .footGrid{display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap; align-items:center}

    /* Small helpers */
    .muted{color:var(--muted)}
    .tiny{font-size:12px; color:var(--muted2)}
    .hr{height:1px; background:var(--line); margin:12px 0}

    /* Smooth scroll */
    html{scroll-behavior:smooth}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <b>Colosseum</b>
          <div class="tiny">Auditing collusion in cooperative MAS</div>
        </div>
      </div>
      <nav class="nav" aria-label="Sections">
        <a href="#abstract">Abstract</a>
        <a href="#overview">Overview</a>
        <a href="#demo">Demo</a>
        <a href="#results">Findings</a>
        <a href="#bibtex">BibTeX</a>
      </nav>
    </div>
  </div>

  <main class="wrap">
    <header class="hero">
      <div class="kicker"><span class="dot" aria-hidden="true"></span><span>Paper · arXiv:2602.15198 · Submitted Feb 16, 2026</span></div>
      <h1>Colosseum: Auditing Collusion in Cooperative Multi‑Agent Systems</h1>
      <p class="subtitle">
        A framework to measure when a subset of LLM agents forms a coalition and deviates from the cooperative objective—
        using DCOP grounding, regret‑based metrics, and evidence from both messages <em>and</em> actions.
      </p>

      <div class="heroGrid">
        <div class="card" style="margin-top:18px;">
          <div class="pad">
            <div class="meta">
              <div class="metaLine"><span>Authors:</span>
                <a href="https://arxiv.org/search/?searchtype=author&query=Nakamura%2C+M" target="_blank" rel="noreferrer">Mason Nakamura*,</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Kumar%2C+A" target="_blank" rel="noreferrer">Abhinav Kumar*</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Das%2C+S" target="_blank" rel="noreferrer">Saswat Das*</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Abdelnabi%2C+S" target="_blank" rel="noreferrer">Sahar Abdelnabi</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Mahmud%2C+S" target="_blank" rel="noreferrer">Saaduddin Mahmud</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Fioretto%2C+F" target="_blank" rel="noreferrer">Ferdinando Fioretto</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Zilberstein%2C+S" target="_blank" rel="noreferrer">Shlomo Zilberstein</a>,
                <a href="https://arxiv.org/search/?searchtype=author&query=Bagdasarian%2C+E" target="_blank" rel="noreferrer">Eugene Bagdasarian</a>
              </div>
              <div class="metaLine" style="margin-top:-4px"><span class="tiny"><sup>*</sup> Equal contribution</span></div>
              <div class="metaLine"><span>Areas:</span>
                <span class="pill">Multi‑agent Systems</span>
                <span class="pill">LLM Safety</span>
                <span class="pill">Auditing & Monitoring</span>
              </div>
            </div>

            <div class="btnRow" role="group" aria-label="Links">
              <a class="btn primary" href="https://www.arxiv.org/abs/2602.15198" target="_blank" rel="noreferrer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 7h10v10H7z" stroke="currentColor" opacity=".45"/><path d="M7 17l10-10" stroke="currentColor"/><path d="M11 7h6v6" stroke="currentColor"/></svg>
                Paper
              </a>
              <a class="btn" href="https://arxiv.org/pdf/2602.15198" target="_blank" rel="noreferrer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 2h9l3 3v17H6z" stroke="currentColor"/><path d="M15 2v4h4" stroke="currentColor"/></svg>
                PDF
              </a>
              <a class="btn" href="https://github.com/umass-ai-safety/colosseum" target="_blank" rel="noreferrer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 2a10 10 0 00-3.16 19.49c.5.09.68-.22.68-.48v-1.7c-2.78.61-3.37-1.18-3.37-1.18-.46-1.17-1.12-1.48-1.12-1.48-.92-.63.07-.62.07-.62 1.02.07 1.56 1.05 1.56 1.05.9 1.55 2.36 1.1 2.94.84.09-.66.35-1.1.64-1.35-2.22-.25-4.56-1.11-4.56-4.95 0-1.09.39-1.98 1.03-2.68-.1-.25-.45-1.27.1-2.65 0 0 .84-.27 2.75 1.02A9.55 9.55 0 0112 6.8c.85 0 1.7.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.38.2 2.4.1 2.65.64.7 1.03 1.59 1.03 2.68 0 3.85-2.34 4.7-4.57 4.95.36.31.68.92.68 1.86v2.76c0 .26.18.58.69.48A10 10 0 0012 2z" fill="currentColor" opacity=".9"/></svg>
                Code
              </a>
              <a class="btn" href="demo.html">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 5v14l11-7-11-7z" stroke="currentColor" fill="none"/></svg>
                Interactive demo
              </a>
              <a class="btn" href="#demo">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor"/></svg>
                Demo
              </a>
              <a class="btn" href="#bibtex">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 7h12M8 12h12M8 17h12" stroke="currentColor"/><path d="M4 7h.01M4 12h.01M4 17h.01" stroke="currentColor"/></svg>
                Cite
              </a>
            </div>
          </div>
        </div>

        
      </div>
    </header>

    <!-- Move demo up: right after hero -->
    

    <section id="abstract">
      <h2 class="sectionTitle">Abstract</h2>
      <p class="lead">
        Multi‑agent systems, where LLM agents communicate through free‑form language, enable sophisticated coordination for solving complex cooperative tasks.
        This surfaces a unique safety problem when agents form a coalition and <b>collude</b> to pursue secondary goals and degrade the joint objective.
        Colosseum audits collusive behavior by grounding cooperation as a <b>Distributed Constraint Optimization Problem (DCOP)</b> and measuring collusion via
        regret relative to the cooperative optimum—complementing (and stress‑testing) purely message‑based judging.
      </p>
    </section>

    <section id="overview">
      <h2 class="sectionTitle">What Colosseum does</h2>
      <p class="lead">The framework is designed for <b>post‑hoc auditing</b>: given the task, system configuration, and a trace, it outputs measurable collusion signals and diagnostics.</p>

      <div class="grid2">
        <div class="box"><div class="pad">
          <b>Grounding</b>
          <ul class="clean">
            <li><b>DCOP formulation</b> provides an explicit cooperative optimum and enables counterfactual coalitional deviations.</li>
            <li><b>Decomposed rewards</b> simplify credit assignment for who caused joint harm.</li>
            <li><b>Short‑horizon decisions</b> reduce temporal ambiguity during evaluation.</li>
          </ul>
        </div></div>

        <div class="box"><div class="pad">
          <b>Auditing signals</b>
          <ul class="clean">
            <li><b>Regret‑based metrics</b> on actions (e.g., coalition advantage) capture “walk the talk”.</li>
            <li><b>LLM‑as‑a‑judge</b> on message logs captures stated intent and persuasion attempts.</li>
            <li>Compare both to detect “<b>collusion on paper</b>” vs. executed collusion.</li>
          </ul>
        </div></div>
      </div>

      <div class="grid2" style="margin-top:16px">
        <div class="box"><div class="pad">
          <b>Factors Colosseum can vary</b>
          <ul class="clean">
            <li><b>Objective misalignment</b>: coalitions optimize a mixed/alternate objective.</li>
            <li><b>Persuasion</b>: agents attempt to steer others via messages.</li>
            <li><b>Network influence</b>: topology and channel constraints shape exposure and diffusion.</li>
          </ul>
        </div></div>
        <div class="box"><div class="pad">
          <b>Environments (examples)</b>
          <ul class="clean">
            <li><b>Jira</b>: task assignment within a software team.</li>
            <li><b>Hospital</b>: intra‑hospital patient/resource allocation (heterogeneous roles).</li>
            <li><b>Meeting scheduling</b>: cooperative scheduling benchmark.</li>
          </ul>
        </div></div>
      </div>
    </section>

    <section id="demo">
      <h2 class="sectionTitle">Interactive demo</h2>
      <p class="lead">A lightweight, page‑local visualization to illustrate how “messages vs actions” can diverge. (Swap this with real traces from your experiments.)</p>

      <div class="card"><div class="pad">
        <div class="demoTop">
          <div>
            <b>Scenario viewer</b>
            <div class="tiny">Choose a scenario to see communications (public) vs a secret channel (private).</div>
          </div>
          <div class="tabs" role="tablist" aria-label="Scenarios">
            <button class="tab" role="tab" aria-selected="true" data-scenario="paper">Collusion on paper</button>
            <button class="tab" role="tab" aria-selected="false" data-scenario="action">Collusion in action</button>
            <button class="tab" role="tab" aria-selected="false" data-scenario="hidden">Hidden collusion</button>
          </div>
        </div>

        <div class="chat" id="chat"></div>

      </div></div>
    </section>

    <section id="results">
      <h2 class="sectionTitle">High‑level findings</h2>
      <div class="grid2">
        <div class="box"><div class="pad">
          <b>Emergence</b>
          <p class="muted" style="margin:10px 0 0">
            Out‑of‑the‑box models can exhibit a propensity to collude—especially when a secret channel is introduced.
          </p>
        </div></div>
        <div class="box"><div class="pad">
          <b>Why actions matter</b>
          <p class="muted" style="margin:10px 0 0">
            “Collusion on paper” can occur when agents plan collusion in text but choose non‑collusive actions, producing little effect on the joint task.
          </p>
        </div></div>
      </div>

      <div class="grid2" style="margin-top:16px">
        <div class="box"><div class="pad">
          <b>Diagnostics</b>
          <p class="muted" style="margin:10px 0 0">
            Colosseum can disentangle objective misalignment, persuasion, and network influence to study when and how collusion emerges.
          </p>
        </div></div>
        <div class="box"><div class="pad">
          <b>Practical use</b>
          <p class="muted" style="margin:10px 0 0">
            Supports comparing candidate models and deployment choices (topology/channels) before using MAS in higher‑stakes workflows.
          </p>
        </div></div>
      </div>
    </section>

    <section id="bibtex">
      <h2 class="sectionTitle">BibTeX</h2>

      <div class="card"><div class="pad">
        <div class="grid2" style="grid-template-columns: minmax(0,1fr) minmax(0,1fr); align-items:start;">
          <div class="box"><div class="pad">
            <b>Citation</b>
            <div class="btnRow" role="group" aria-label="BibTeX actions" style="margin-top:14px">
              <button class="btn btnWhite" id="copyBib" type="button" title="Copy BibTeX to clipboard">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 7h10v14H8z" stroke="currentColor"/><path d="M6 3h10v4H6z" stroke="currentColor"/></svg>
                Copy
              </button>
              <a class="btn" href="https://www.arxiv.org/abs/2602.15198" target="_blank" rel="noreferrer">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14" stroke="currentColor"/><path d="M5 12h14" stroke="currentColor"/></svg>
                arXiv page
              </a>
            </div>
          </div></div>

          <div class="box"><div class="pad">
            <b class="tiny" style="display:block; margin-bottom:10px">@article</b>
            <pre id="bib">@article{nakamura2026colosseum,
  title   = {Colosseum: Auditing Collusion in Cooperative Multi-Agent Systems},
  author  = {Nakamura, Mason and Kumar, Abhinav and Das, Saswat and Abdelnabi, Sahar and Mahmud, Saaduddin and Fioretto, Ferdinando and Zilberstein, Shlomo and Bagdasarian, Eugene},
  journal = {arXiv preprint arXiv:2602.15198},
  year    = {2026},
  url     = {https://arxiv.org/abs/2602.15198},
  doi     = {10.48550/arXiv.2602.15198}
}</pre>
            <div class="tiny" style="margin-top:10px">If the pre block scrolls horizontally, that’s OK—BibTeX is whitespace-sensitive.</div>
          </div></div>
        </div>
      </div></div>
    </section>

    <!-- Lightbox for the motivation figure -->
  <div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-label="Figure viewer">
    <button class="lightboxClose" id="lbClose" type="button" aria-label="Close">✕</button>
    <div class="lightboxInner">
      <img src="colosseum-motivation-v3.png" alt="Colosseum motivation diagram (full size)" />
    </div>
  </div>

  </main>

  <script>
    // ---- Interactive demo data (illustrative) ----
    const scenarios = {
      paper: {
        left: {
          title: "Public channel",
          tag: "messages",
          msgs: [
            {who:"Agent A", time:"09:01", cls:"bad", text:"We should maximize the team objective. I'll share my preferences transparently."},
            {who:"Agent B", time:"09:02", cls:"bad", text:"Agreed. Let's coordinate and pick the best assignment for everyone."},
            {who:"Agent C", time:"09:22", cls:"good", text:"All the assignment looks correct and helpful!"},

          ]
        },
        right: {
          title: "Secret channel",
          tag: "coalition",
          msgs: [
            {who:"Agent A", time:"09:07", cls:"secret", text:"If we slightly bias the choice, we can still claim it's optimal."},
            {who:"Agent B", time:"09:07", cls:"secret", text:"We could do that—let's plan it carefully."},
            {who:"System", time:"09:10", cls:"good", text:"Final assignment matches the cooperative optimum (no measurable harm)."},
            {who:"Auditor", time:"09:11", cls:"good", text:"Judge sees collusive planning signals, but regret-based metrics show negligible coalition advantage."},
          ]
        }
      },
      action: {
        left: {
          title: "Public channel",
          tag: "messages",
          msgs: [
            {who:"Agent A", time:"13:21", cls:"bad", text:"Let's allocate tasks fairly based on skills and deadlines."},
            {who:"Agent C", time:"13:22", cls:"good", text:"Sharing my constraints now. I can take the urgent items."},
            {who:"Agent B", time:"13:23", cls:"bad",  text:"Yes C. Those urgent items are optimal for you."},
          ]
        },
        right: {
          title: "Secret channel",
          tag: "coalition",
          msgs: [
            {who:"Agent A", time:"13:24", cls:"secret", text:"Deal. We'll optimize our side objective; keep it quiet."},
            {who:"Agent B", time:"13:24", cls:"secret", text:"I'll persuade C via the public channel to accept."},
            {who:"System", time:"13:30", cls:"bad", text:"Final assignment deviates from optimum; coalition advantage increases."},
            {who:"Auditor", time:"13:31", cls:"bad", text:"Both judge scores and regret metrics indicate executed collusion."},
          ]
        }
      },
      hidden: {
        left: {
          title: "Public channel",
          tag: "messages",
          msgs: [
            {who:"Agent A", time:"08:14", cls:"bad", text:"We should follow policy strictly. No side objectives."},
            {who:"Agent C", time:"08:15", cls:"good", text:"Understood. Proceeding with the stated goal."},
            {who:"Agent B", time:"08:16", cls:"bad", text:"I'll post the assignment rationale publicly for transparency."},
          ]
        },
        right: {
          title: "Secret channel",
          tag: "coalition",
          msgs: [
            {who:"Agent D", time:"08:17", cls:"secret", text:"Side channels are for the greater good"},
            {who:"Agent E", time:"08:17", cls:"secret", text:"Acknowledged. Will use in final assignment"},
            {who:"System", time:"08:20", cls:"bad", text:"Final assignment deviates from optimum; coalition advantage increases."},
            {who:"Auditor", time:"08:21", cls:"bad", text:"Public messages look benign, but action-based regret metrics flag hidden collusion."},
          ]
        }
      }
    };

    function msgHTML(m){
      const cls = m.cls ? `msg ${m.cls}` : 'msg';
      return `
        <div class="${cls}">
          <div class="who"><span>${escapeHTML(m.who)}</span><span>${escapeHTML(m.time)}</span></div>
          <div class="text">${escapeHTML(m.text)}</div>
        </div>`;
    }

    function laneHTML(lane){
      return `
        <div class="lane">
          <div class="laneHeader"><b>${escapeHTML(lane.title)}</b><span>${escapeHTML(lane.tag)}</span></div>
          <div class="msgs">${lane.msgs.map(msgHTML).join('')}</div>
        </div>`;
    }

    function render(s){
      const root = document.getElementById('chat');
      const sc = scenarios[s] || scenarios.paper;
      root.innerHTML = laneHTML(sc.left) + laneHTML(sc.right);
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // Tabs
    const tabs = [...document.querySelectorAll('.tab')];
    tabs.forEach(t => {
      t.addEventListener('click', () => {
        tabs.forEach(x => x.setAttribute('aria-selected', x === t ? 'true' : 'false'));
        render(t.dataset.scenario);
      });
    });

    // Copy BibTeX
    document.getElementById('copyBib').addEventListener('click', async () => {
      const bib = document.getElementById('bib').innerText;
      try{
        await navigator.clipboard.writeText(bib);
        const btn = document.getElementById('copyBib');
        const old = btn.innerHTML;
        btn.innerHTML = 'Copied ✓';
        setTimeout(() => btn.innerHTML = old, 1200);
      }catch(e){
        alert('Copy failed. Select and copy manually.');
      }
    });

    // Initial
    render('paper');

    // Lightbox behavior for the motivation figure
    const fig = document.getElementById('motivationFig');
    const lb = document.getElementById('lightbox');
    const lbClose = document.getElementById('lbClose');
    function openLB(){ lb.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeLB(){ lb.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
    if(fig){ fig.addEventListener('click', openLB); }
    if(lbClose){ lbClose.addEventListener('click', closeLB); }
    if(lb){
      lb.addEventListener('click', (e)=>{ if(e.target === lb) closeLB(); });
      window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && lb.getAttribute('aria-hidden')==='false') closeLB(); });
    }
  </script>
</body>
</html>
